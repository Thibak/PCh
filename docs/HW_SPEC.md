# **Спецификация оборудования (Hardware Specification)**

**Назначение документа:** \> Этот документ описывает физические компоненты, используемые в устройстве, и их технические требования. Он дополняет `PRD.MD` и `ARCH_CONTRACT.MD` деталями аппаратной реализации.

## **1\. Логическая компоновка**

Физическая компоновка устройства и потоки питания/данных описаны в `docs/architecture_diagrams.md` (Раздел 3\. Диаграмма физической компоновки).

Ключевые потоки:

* **Питание:** `USB (5V) -> TP4056 -> Аккумулятор (3.7V) -> Boost-конвертор -> ESP32/Сенсоры (3.3V)`.  
* **Данные:** `USB (D+/D-) <-> ESP32 <-> Сенсоры (Touch Pins)`.

## **2\. Спецификация компонентов**

### **2.1. Центральный процессор (MCU)**

* **Компонент:** Плата разработки на базе **ESP32-S3**.  
* **Требования (из `PRD.MD`):**  
  * Поддержка BLE (для MIDI).  
  * Встроенный **USB 2.0 OTG** (для композитного устройства Mass Storage \+ Serial).  
  * Встроенная Flash-память: 8 МБ (минимум).  
  * Встроенная RAM: 512 КБ (минимум).  
  * **Встроенные емкостные сенсорные пины (Touch Pins)** для 8-12 сенсоров.  
  * Рабочее напряжение: 3.3V.  
  * **Встроенный LED** (предпочтительно RGB, напр. Neopixel/Dotstar).  
  * **Встроенный разъем USB-C**.  
  * Встроенные кнопки (RST/BOOT) для разработки/прошивки.

### **2.2. Сенсорная подсистема**

* **Компонент:** **Емкостные сенсоры**.  
* **Требования (из PRD.MD):**  
  * Количество: 9-12 (в зависимости от `settings.cfg`).  
  * **Реализация:** Используют встроенные **ESP32 Touch Pins**. Внешнее оборудование не требуется (кроме самих контактных площадок).  
  * Интерфейс: Прямое подключение к Touch-пинам ESP32-S3.  
  * Рабочее напряжение: 3.3V (от платы).  
  * **Реализация:** Используют встроенные **ESP32 Touch Pins**. Внешнее оборудование не требуется (кроме самих контактных площадок).  
  * Интерфейс: Прямое подключение к Touch-пинам ESP32-S3.  
  * Рабочее напряжение: 3.3V (от платы).

### **2.3. Система питания**

* **Аккумулятор:**  
  * **Тип:** LiPo (Литий-полимерный).  
  * **Напряжение:** 3.7V (номинальное).  
  * **Емкость (TBD):** Должна обеспечивать TBD часов автономной работы.  
* **Модуль зарядки:**  
  * **Тип:** На базе контроллера TP4056 (или аналог, часто интегрирован на платы ESP32).  
  * **Требования:**  
    * Зарядка от USB (5V).  
    * Защита аккумулятора (от перезаряда, переразряда, КЗ).  
* **Конвертор питания:**  
  * **Тип:** Повышающий (Boost) DC-DC конвертор (может быть интегрирован на плату ESP32).  
  * **Требования:**  
    * Вход: 3.0V \- 4.2V (диапазон LiPo).  
    * Выход: Стабильные 3.3V.  
    * Достаточная мощность для питания ESP32-S3 (в режиме BLE) и всех сенсоров.  
* **Управление питанием:**  
  * **Тип:** **Внешняя** физическая кнопка питания (не путать с кнопками RST/BOOT на плате).  
  * **Требования:** (см. `ARCH_CONTRACT.MD 4.1`) Устройство должно иметь возможность полного аппаратного самоотключения (`soft-latch`), управляемого этой кнопкой и `hal_power->triggerPowerOff()`.

### **2.4. Интерфейсы и индикация**

* **USB:**  
  * **Тип:** Разъем **USB-C (встроенный на плату ESP32-S3)**.  
  * **Требования:** Подключен к ESP32-S3 `(D+/D-)` и TP4056 `(VBUS/GND)`.  
* **LED:**  
  * **Тип:** **Встроенный LED на плате ESP32-S3** (предпочтительно RGB, напр. Neopixel).  
  * **Требования (из PRD.MD):**  
    * Управляется MCU (через `i_hal_led.h`).  
    * Должен быть способен отображать: "частое мигание", "горит", "одиночное моргание".

## **3\. Компоновка и Подключения (Pinout Blueprint)**

В этом разделе описываются **точные** соединения между компонентами. Так как используются готовые модули (платы), многие соединения являются внутренними (напр., USB, LED).

**Примечание:** Назначение *физических пинов* (T1, T2...) на *логические ID* `(ID 0, ID 1...)` определяется в файле **`settings.cfg`** (секция `[sensors]`).

| Физический Пин ESP32 | Логический ID (Пример) | Назначение / HAL Модуль | Примечание |
| :---- | :---- | :---- | :---- |
| **`D-`, `D+`, `VBUS`, `GND`** | `N/A` | `hal_usb` / `hal_power` | Встроено в плату ESP32-S3. |
| **`<TBD: GPIO_LED>`** | `N/A` | `hal_led` | Пин встроенного LED (напр. GPIO 38 или 48). |
| **`<TBD: GPIO_PWR>`** | `N/A` | `hal_power` / Аппаратная схема | Пин, управляющий "soft-latch" (подачей питания) |
|  |  |  |  |
| **`<TBD: TOUCH_PIN_1>`** | `ID 0` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
| **`<TBD: TOUCH_PIN_2>`** | `ID 1` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
| **`<TBD: TOUCH_PIN_3>`** | `ID 2` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
| **`<TBD: TOUCH_PIN_4>`** | `ID 3` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
| **`<TBD: TOUCH_PIN_5>`** | `ID 4` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
| **`<TBD: TOUCH_PIN_6>`** | `ID 5` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
| **`<TBD: TOUCH_PIN_7>`** | `ID 6` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
| **`<TBD: TOUCH_PIN_8>`** | `ID 7` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
| **`<TBD: TOUCH_PIN_9>`** | `ID 8` (по `settings.cfg`) | `hal_sensors` | Физический пин T1-T14 |
|  |  |  |  |
| **TP4056 / Boost** | `VBUS`, `GND`, `VCC_3V3` | Питание | Внутренние соединения платы. |
| **Аккумулятор** | `BAT+`, `BAT-` | Питание | Подключается к TP4056. |

